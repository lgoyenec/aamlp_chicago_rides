---
title : '<h2>Descriptive Statistics'
author: '95-845 AAMLP <hr><b>Final Project</b> <br><br><h4>Nathan Deron <br>David Contreras <br>Laura Goyeneche'
date  : '<h5>10/30/2019'
output:
  html_document:
     theme: cerulean
     toc: true
     code_folding: hide
     highlight: tango
---

```{r setup, include = F}
knitr::opts_chunk$set(echo = T, cache = T)
```

```{r, include = F}
# Define libraries
libs = c('httr','jsonlite',
         'dplyr',
         'stringr',
         'readr','data.table',
         'lubridate',
         'knitr','kableExtra',
         'fastDummies',
         'papeR',
         'ggcorrplot','plotly','GGally')

# Attach libraries
invisible(suppressMessages(lapply(libs, library, character.only = T)))
```

```{r}
# Working directory
cd = 'C:/Users/lgoye/OneDrive/Education/CarnegieMellonUniversity/PPMDACourses/95845_ML_Pipeline/Final Project'
setwd(cd)

# Import data
# City of Chicago

  # Import 3 datasets
  # Taxi trips 1.3 out of 187 million observations 
  # Other providers trips: 8.9 out of 101 million observations
  # Crime in Chicago: 35,494 out of 7 million observations

  df_taxi  = readRDS(paste0(cd, '/data_rds/df_taxi.rds'))
  df_other = readRDS(paste0(cd, '/data_rds/df_other.rds'))
  df_crime = readRDS(paste0(cd, '/data_rds/df_crime.rds'))
```

```{r}
# Data pre-processing 
# Taxi trips

names(df_taxi) = tolower(names(df_taxi))

taxi = 
  df_taxi %>%
  
    # # Create time variables: year, month, hour
    # mutate(date_start = ymd_hms(trip.start.timestamp),
    #        date_end   = ymd_hms(trip.end.timestamp),
    #        year       = year(date_start),
    #        month      = month(date_start)) %>%
    # 
    # # Remove timestamp variables and pickup location
    # select(-trip.start.timestamp, 
    #        -trip.end.timestamp,
    #        -pickup.centroid.location,
    #        -dropoff.centroid.location) %>%
    # 
    # # Generate factor variables
    # mutate(payment_type = as.factor(payment.type),
    #        company      = as.factor(company),
    #        trip_id      = as.factor(trip.id),
    #        taxi_id      = as.factor(taxi.id)) %>%
  
  # Destring numeric variables
  mutate_if(is.character, as.numeric)

# Ridesharing trips
names(df_other) = tolower(names(df_other))
other = 
  df_other %>%
  mutate_if(is.character, as.numeric)

# Crime 
names(df_crime) = tolower(names(df_crime))
crime = 
  df_crime %>%
  mutate_if(is.character, as.numeric)
  
```

## Taxi trips {.tabset .tabset-fade .tabset-pills}
### Summary of NAs
```{r, warning = F, message = F}
taxi %>%
  is.na() %>%
  colSums() %>%
  data.frame(countNA = .) %>%
  add_rownames(var = "Variable") %>%
  filter(countNA > 0) %>%
  kable(col.names = c("","Number of NAs")) %>%
  kable_styling(full_width = F)
```

### Correlation
```{r, warning = F, message = F, fig.align = "center", fig.height = 6, fig.width = 8}
df_taxi %>%
  select(trip_seconds,
         trip_miles, 
         fare, 
         tips, 
         extras, 
         trip_total) %>%
  ggpairs(aes(color = I("#E1A533")),
          columnLabels = c("Trip Sec", "Trip Miles", "Fare", "Tips", "Extras", "Trip Total")) + 
  theme_bw()
```

### Top 10 pickup CA
```{r, fig.align = "center"}
df_taxi %>%
  filter(!is.na(pickup_community_area)) %>%
  group_by(pickup_community_area) %>%
  summarise(freq = n()) %>%
  arrange(-freq) %>%
  head(n = 10) %>%
  mutate(pickup_community_area = as.character(pickup_community_area)) %>%
  ggplot(aes(x = pickup_community_area, y = freq)) + 
  geom_text(aes(label = freq), vjust = -0.3) +
  geom_bar(fill = '#FAA916', stat = 'identity')
```

### Top 10 dropoff CA
```{r, fig.align = "center"}
df_taxi %>%
  filter(!is.na(dropoff_community_area)) %>%
  group_by(dropoff_community_area) %>%
  summarise(freq = n()) %>%
  arrange(-freq) %>%
  head(n = 10) %>%
  mutate(dropoff_community_area = as.character(dropoff_community_area)) %>%
  ggplot(aes(x = dropoff_community_area, y = freq)) + 
  geom_text(aes(label = freq), vjust = -0.3) +
  geom_bar(fill = '#FAA916', stat = 'identity')
```

## Other providers {.tabset .tabset-fade .tabset-pills}
### Summary of NAs
```{r, warning = F, message = F}
other %>%
  is.na() %>%
  colSums() %>%
  data.frame(countNA = .) %>%
  add_rownames(var = "Variable") %>%
  filter(countNA > 0) %>%
  kable(col.names = c("","Number of NAs")) %>%
  kable_styling(full_width = F)
```

## Crime {.tabset .tabset-fade .tabset-pills}
### Summary of NAs
```{r, warning = F, message = F}
crime %>%
  is.na() %>%
  colSums() %>%
  data.frame(countNA = .) %>%
  add_rownames(var = "Variable") %>%
  filter(countNA > 0) %>%
  kable(col.names = c("","Number of NAs")) %>%
  kable_styling(full_width = F)
```





















